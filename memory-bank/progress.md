# Project Progress

Этот документ отражает детальный прогресс по всем этапам проекта в формате чек-листа.

---
### **Блок 1: Фундамент и Архитектура**
---

#### Этап 1: Базовая настройка и правила
- [x] Инициализировать проект Next.js v15 с TypeScript.
- [x] Настроить Docker, `docker-compose.yml`, ESLint, Prettier.
- [x] Создать и утвердить "банк памяти" (`memory-bank`).
- [x] Сформулировать и утвердить правила разработки в `rules/memory-bank.mdc`.
- [x] Исправить конфигурацию ESLint для корректной работы в IDE.

#### Этап 2: Моделирование данных и Auth
- [x] Спроектировать и реализовать мультифайловую схему Prisma.
- [x] Создать и применить миграции базы данных.
- [x] Реализовать API для регистрации, входа и выхода (`/register`, `/login`, `/logout`).
- [x] Реализовать API для получения данных пользователя (`/me`) с актуализацией из БД.
- [x] Внедрить систему ролей (`UserRoleEnum`) и JWT в `HttpOnly` cookie.
- [x] Создать хук `useAuth` для управления состоянием на клиенте.
- [ ] Настроить отправку email для подтверждения регистрации.

#### Этап 3: Внедрение Schema-Driven Development (Zod)
- [x] **Цель:** Создать единый источник правды для DTO.
- [x] В `src/schemas/` создать файлы `...Schemas.ts` для чата и пользователя.
- [x] В них определить Zod-схемы, описывающие публичные данные.
- [x] В файлах `...Types.ts` заменить ручные `interface` на типы, выведенные из схем (`z.infer`).
- [x] Обновить мапперы (`src/lib/mappers/`) для использования `.parse(schema)`.
- [x] Устранить небезопасные приведения типов (`as`) и использование `any`.

#### Этап 4: Внедрение стратегии обработки ошибок (Frontend)
- [x] **Цель:** Обеспечить централизованную и понятную пользователю обработку ошибок.
- [x] Установить зависимость `react-hot-toast` и добавить `<Toaster />`.
- [x] Модифицировать хуки `useAuth` и `useChat`, добавив `error` в состояние и вызов `toast.error()`.
- [x] Улучшить обработку ошибок в `AuthProvider` для предотвращения "зависших" состояний.
- [x] Обновить UI-компоненты (`LoginForm`) для отображения `error` из хуков.

---
### **Блок 2: Основной функционал**
---

#### Этап 5: Базовая функциональность чатов (API и Socket)
- [x] Настроен выделенный `socket-server` с Redis-адаптером и JWT-аутентификацией.
- [x] Реализован API `POST /api/chats/create` с публикацией события в Redis.
- [x] Завершена логика сохранения сообщения в БД с обновлением `updatedAt` у чата.
- [x] `socket-server` обрабатывает `CLIENT_EVENT_SEND_MESSAGE` и рассылает `SERVER_EVENT_RECEIVE_MESSAGE`.
- [x] Реализован API `GET /api/chats` для получения списка чатов с корректной проверкой прав.
- [x] Реализован API `GET /api/chats/[chatId]` для получения данных чата с корректной проверкой прав.
- [ ] Реализовать отдельный API `GET /api/chats/[chatId]/messages` с полной пагинацией.

#### Этап 6: Push-уведомления (Backend)
- [ ] **Цель:** Подготовить бэкенд для отправки уведомлений.
- [ ] Добавить модель `PushSubscription.prisma` в схему и применить миграцию.
- [ ] Реализовать API `POST /api/push/subscribe` и `POST /api/push/unsubscribe`.
- [ ] Установить `web-push` и настроить VAPID ключи в `.env`.

#### Этап 7: Push-уведомления (Frontend)
- [ ] **Цель:** Реализовать полный цикл работы Push-уведомлений.
- [ ] Создать UI для включения уведомлений в настройках профиля.
- [ ] Реализовать клиентскую логику запроса разрешений и отправки подписки.
- [ ] Настроить Service Worker для обработки `push` событий.
- [ ] Интегрировать отправку push-сообщений в `socket-server`.
- [ ] Реализовать `Badging API` для иконки приложения.

#### Этап 8: Внедрение глобального стейт-менеджера (Zustand)
- [ ] **Цель:** Синхронизировать состояние между независимыми частями UI.
- [ ] Доработать `chatStore` для управления списком чатов и счетчиками непрочитанных сообщений.
- [ ] Интегрировать `chatStore` с сайдбаром для отображения списка.
- [ ] Настроить WebSocket-слушатель для обновления стора при новых событиях.

---
### **Блок 3: Завершение и качество**
---

#### Этап 9: Продвинутая функциональность сообщений
- [ ] Реализовать E2E-шифрование сообщений.
- [ ] Реализовать загрузку файлов.
- [ ] Реализовать ответы, редактирование и "мягкое" удаление сообщений.

#### Этап 10: UI/UX и Компоненты
- [ ] Интегрировать MUI и настроить общую тему.
- [ ] Разработать полный набор компонентов: `ChatList`, `MessageBubble`, `ChatSettingsModal` и др.
- [ ] Обеспечить полную адаптивность и отзывчивость интерфейса.

#### Этап 11: Админ-панель
- [ ] Создать UI для `admin/dashboard` на серверных компонентах.
- [ ] Реализовать API для управления пользователями и чатами.

#### Этап 12: Качество и CI/CD
- [ ] Написать TSDoc для всех ключевых модулей и функций.
- [ ] Настроить Jest и Playwright, написать тесты для основных сценариев.
- [ ] Настроить GitHub Actions для CI/CD.
- [ ] Обновить `README.md` и сгенерировать OpenAPI-документацию. 