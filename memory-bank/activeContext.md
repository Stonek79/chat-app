# Активный план доработок (Текущий Спринт)

**Процесс работы:** Этот документ содержит детальный план для *текущего* этапа. После завершения всех задач, мы обновляем `progress.md` и планируем следующий этап.

---

### **Текущий Этап: 5. UI/UX и медиа**
**Цель:** Завершить рестайлинг интерфейса в стиле Telegram, сделать его полностью адаптивным и реализовать масштабируемую архитектуру для загрузки пользовательских медиафайлов (начиная с аватаров).

#### **Часть 1: Завершение рестайлинга и адаптивность (в процессе)**

1.  **[ ] Финальная стилизация компонентов:**
    - **Действие:** Проверить и доработать стили `Sidebar`, `ChatHeader`, `MessageBubble`, `MessageInput` в соответствии с референсами.

2.  **[ ] Группировка сообщений:**
    - **Действие:** Реализовать корректную визуальную группировку последовательных сообщений от одного пользователя.

3.  **[ ] Адаптивный layout:**
    - **Действие:** Обеспечить полное соответствие мобильного вида приложения предоставленным скриншотам. Адаптировать сетку и компоненты для корректного отображения на разных разрешениях экрана.

---

### **Часть 2: Инфраструктура для медиафайлов (планируется)**

4.  **[ ] Настройка Docker-сервисов:**
    - **Действие:** Добавить и настроить в `docker-compose.yml` сервисы для **MinIO** (S3-совместимое хранилище) и **Nginx** (в качестве прокси и кэширующего сервера для медиа).

5.  **[ ] Создание пакета для работы с медиа:**
    - **Действие:** Создать новый workspace-пакет `@chat-app/media-storage`, который инкапсулирует всю логику по работе с файлами (загрузка, удаление, получение URL).

---

### **Часть 3: Реализация загрузки аватаров (dev-версия, ✅ ЗАВЕРШЕНО)**

6.  **[✅] Рефакторинг AuthProvider и хук useAvatar:**
    - **Действие:** Перевести `AuthProvider` на `useSWR` для автоматического обновления данных пользователя. Создать хук `useAvatar` для инкапсуляции логики загрузки/удаления аватара с оптимистичным UI.

7.  **[✅] API-маршрут для загрузки:**
    - **Действие:** Адаптирован существующий маршрут `POST /api/files/avatar` для работы с новым флоу. Маршрут корректно обновляет `avatarUrl` и перевыпускает JWT.

8.  **[✅] Frontend-компонент `AvatarUpload`:**
    - **Действие:** Разработан "глупый" UI-компонент, который использует хук `useAvatar` для всей логики.

9.  **[✅] Интеграция с формой профиля:**
    - **Действие:** Компонент `AvatarUpload` успешно интегрирован в страницу редактирования профиля.

---

### **Текущий Этап: 6. Продвинутая функциональность сообщений (в процессе)**
**Цель:** Реализовать базовые CRUD-операции над сообщениями (редактирование, удаление, ответы), обеспечив целостность данных и прав доступа.

1.  **[✅] Реализация необратимого удаления сообщений (Hard Delete):**
    - **Действие:** Разработан и утвержден план по полному физическому удалению сообщений.
    - **Логика Бэкенда:** Включает проверку прав (автор или админ), атомарную транзакцию для обнуления `replyToId` и удаления медиафайлов, и финальное удаление записи из БД.
    - **Логика Фронтенда:** Использует оптимистичное обновление UI и откат в случае ошибки API. Сокет-событие `SERVER_EVENT_MESSAGE_DELETED` синхронизирует всех клиентов.

2.  **[ ] Реализация редактирования сообщений:**
    - **Действие:** Спланировать и реализовать возможность редактирования текста сообщения.

3.  **[ ] Реализация ответов на сообщения:**
    - **Действие:** Спланировать и реализовать UI и бэкенд-логику для ответов на конкретные сообщения.


## Ближайшие цели (после текущего фокуса)

- **[ ] Этап 7: Push-уведомления**
- **[ ] Этап 8: E2E-шифрование** 