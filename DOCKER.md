# üê≥ Docker: –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∑–∞–ø—É—Å–∫—É –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

## üìã –û–±–∑–æ—Ä

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ **chat-app** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Docker. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –¥–ª—è **—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (development)** –∏ **–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ (production)**.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

```mermaid
graph TD;
    subgraph "Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã"
        A[Next.js App <br/> Port: 3000]
        B[Socket.IO Server <br/> Port: 3001]
        C[PostgreSQL <br/> Port: 5432] // <-- –î–û–ë–ê–í–ò–¢–¨ –≠–¢–û–¢ –°–ï–†–í–ò–°
        D[Redis <br/> Port: 6379]
        E[MinIO Storage <br/> Port: 9000/9001] // <-- –£–¢–û–ß–ù–ò–¢–¨ –ü–û–†–¢–´
        F[Nginx Proxy <br/> Port: 8080]
    end
    
    User[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å] -->|HTTP| A;
    A -->|Socket.IO| B;
    A -->|API| C;
    B --> C;
    A --> D;
    B --> D;
    A -->|–ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–¥–∏–∞| E;
    User -->|–ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ–¥–∏–∞| F;
    F --> E;
```

## üöÄ –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (Development)

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –ï—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç, —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏–∑ –ø—Ä–∏–º–µ—Ä–∞:
```bash
cp .env.example .env
```

### 2. –ó–∞–ø—É—Å–∫

–ü—Ä–æ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –æ–¥–Ω—É –∫–æ–º–∞–Ω–¥—É. –û–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `docker-compose.yml` –∏ `docker-compose.override.yml` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è dev-–æ–∫—Ä—É–∂–µ–Ω–∏—è —Å hot-reload.

```bash
docker compose up --build
```
> –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–±–æ—Ä–∫–∞ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç. –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—É—Å–∫–∏ –±—É–¥—É—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –±—ã—Å—Ç—Ä–µ–µ.

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:3000`.

## üè≠ –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ (Production)

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Production

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.production` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ –±–æ–µ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ (—Ä–µ–∞–ª—å–Ω—ã–µ –¥–æ–º–µ–Ω—ã, `NODE_ENV=production`, —Å–ª–æ–∂–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã).

### 2. –ó–∞–ø—É—Å–∫

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–ª–∞–≥ `--env-file`, —á—Ç–æ–±—ã —É–∫–∞–∑–∞—Ç—å Docker Compose –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∞—à production-–∫–æ–Ω—Ñ–∏–≥.

```bash
docker compose --env-file .env.production up --build -d
```
> –§–ª–∞–≥ `-d` –∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ (detached).

## üõ†Ô∏è –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
# –õ–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker compose logs -f

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker compose logs -f next_app_chat
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker compose down

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ (–±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, –∫—ç—à, –º–µ–¥–∏–∞-—Ñ–∞–π–ª—ã)
docker compose down -v
```

### Prisma Studio (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
–î–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ UI –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å Prisma Studio.
```bash
# –ó–∞–ø—É—Å–∫ —Å –ø—Ä–æ—Ñ–∏–ª–µ–º 'dev', –∫–æ—Ç–æ—Ä—ã–π –≤–∫–ª—é—á–∞–µ—Ç Prisma Studio
docker compose --profile dev up
```
Prisma Studio –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:5555`.


## üìÅ –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

-   **`Dockerfile`**: –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –¥–ª—è —Å–±–æ—Ä–∫–∏ `next-app`. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç multi-stage build –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ –¥–ª—è production –∏ dev-—Å—Ç–µ–π–¥–∂–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.
-   **`apps/socket-server/Dockerfile`**: –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π Dockerfile –¥–ª—è `socket-server`.
-   **`docker-compose.yml`**: –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è **production**.
-   **`docker-compose.override.yml`**: –§–∞–π–ª –¥–ª—è **—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**. –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ dev-—Å–µ—Ä–≤–µ—Ä–æ–≤ –∏ –≤–∫–ª—é—á–∞–µ—Ç hot-reload.
-   **`Dockerfile.prisma-studio`**: –õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π Dockerfile –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Prisma Studio.
-   **`DOCKER.md`**: –≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ.
